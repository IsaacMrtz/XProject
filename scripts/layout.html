<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title><%= title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="resources/css/layouts.css">
  
 
</head>
<body>
  <header>
    <button id="btnBack">â† Volver</button>
    
  </header>
<!-- Oculto al inicio pero presente en el DOM -->
<div id="videoFrame" style="display:none;">
  <video id="video" autoplay muted playsinline></video>
</div>
  <main>
    <div id="content">
      <div id="completed">Â¡Completado!</div>
      <!-- AquÃ­ inyecta tu tÃ­tulo y texto dinÃ¡mico -->
      <!-- Por ejemplo: -->
      <h2 id="itemTitle"></h2>
      <p id="itemText"></p>


      <div id="controls">
        <button id="btnSpeak" class="control-btn">Hablar</button>
        <button id="btnNext" class="control-btn" style="display:none;">
          Siguiente â†’
        </button>
      </div>
      <div id="transcription" class="transcription-box">
      <em>Tu transcripciÃ³n aparecerÃ¡ aquÃ­â€¦</em>
    </div>
    </div>
  </main>
  <aside class="nivelC-sidebar">
  <div class="stat-card">
    ğŸ“š Lecturas: 
    <span id="lecturas-leidas"><%= stats.lecturasLeidas %></span> /
    <span id="total-lecturas"><%= stats.totalLecturas %></span>
    <div class="progress-bar">
      <div id="lecturas-bar"
           style="width: <%= (stats.lecturasLeidas / stats.totalLecturas) * 100 %>%">
      </div>
    </div>
  </div>
  <br>
  <div class="stat-card">
    ğŸ® Juegos:
    <span id="juegos-jugados"><%= stats.juegosJugados %></span>
  </div>
  <br>
  <div class="stat-card">
    ğŸ… Nivel:
    <span id="nivel-actual"><%= stats.nivelActual %></span>
  </div>
  <br>
  <div class="stat-card">
    ğŸš€ DesafÃ­os activos:
    <span id="desafios-activos"><%= stats.desafiosActivos %></span>
  </div>
  <div class="botones-regreso">
                <a href="javascript:history.back()" class="btn-back">â† Regresar</a>
              </div>
</aside>

  <!-- LibrerÃ­as y mÃ³dulos -->
  <script src="/resources/jsFace-Api/face-api.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
   <script>
    window.appParams = {
      grado: "<%= grado %>",
      id:    "<%= id %>"
    };
    window.appStats = {
      lecturasLeidas:  <%= stats.lecturasLeidas %>,
      totalLecturas:   <%= stats.totalLecturas %>,
      juegosJugados:   <%= stats.juegosJugados %>,
      nivelActual:     <%= stats.nivelActual %>,
      desafiosActivos: <%= stats.desafiosActivos %>
    };
  </script>
     
  <script type="module" src="/scripts/orquestador.js"></script>
  <script type="module" src="../scripts/uiRenderer.js"></script>


    <!-- Paso de parÃ¡metros al cliente -->
 

  <script>
    // Volver a la ruta anterior
    document.getElementById('btnBack').addEventListener('click', () => {
      window.history.back();
    });

    // Escucha evento de â€œcompletadoâ€ desde orquestador.js
    window.addEventListener('readingComplete', () => {
      document.getElementById('completed').style.display = 'block';
      document.getElementById('btnNext').style.display = 'inline-block';
    });

    // BotÃ³n Hablar â†’ activa Web Speech
    document.getElementById('btnSpeak').addEventListener('click', () => {
      window.dispatchEvent(new Event('startSpeech')); 
      // Orquestador debe escuchar startSpeech y arrancar reconocimiento
    });

    // BotÃ³n Siguiente â†’ recarga contenido segÃºn orquestador
    document.getElementById('btnNext').addEventListener('click', () => {
      window.dispatchEvent(new Event('nextItem'));
      // Orquestador escucha nextItem y carga siguiente Ã­tem
      document.getElementById('completed').style.display = 'none';
      document.getElementById('btnNext').style.display = 'none';
    });
  </script>
</body>
</html>
